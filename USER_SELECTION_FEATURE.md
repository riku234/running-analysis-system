# ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠæ©Ÿèƒ½ å®Ÿè£…å®Œäº†

## ğŸ¯ æ¦‚è¦

å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠã§ãã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚é¸æŠã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚Œã€èª°ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã‹ã‚’è¿½è·¡ã§ãã¾ã™ã€‚

---

## ğŸ“Š ç™»éŒ²æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ14åï¼‰

### VFã‚¹ã‚¿ãƒƒãƒ•ï¼ˆ3åï¼‰
- **VFçŸ¢æ²»** (`vf_yaji`)
- **VFå¤§é‡** (`vf_ono`)
- **VFåºƒå·** (`vf_hirokawa`)

### Xã‚¹ã‚¿ãƒƒãƒ•ï¼ˆ5åï¼‰
- **Xé˜¿æ±Ÿ** (`x_ae`)
- **Xå¢—ç”°** (`x_masuda`)
- **Xå°æ¾** (`x_komatsu`)
- **Xéˆ´æœ¨** (`x_suzuki`)
- **Xè¿‘é‡** (`x_konno`)

### ã‚²ã‚¹ãƒˆï¼ˆ5åï¼‰
- **ã‚²ã‚¹ãƒˆ1** (`guest1`)
- **ã‚²ã‚¹ãƒˆ2** (`guest2`)
- **ã‚²ã‚¹ãƒˆ3** (`guest3`)
- **ã‚²ã‚¹ãƒˆ4** (`guest4`)
- **ã‚²ã‚¹ãƒˆ5** (`guest5`)

### ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ1åï¼‰
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼** (`default_user`) - æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ç”¨

---

## ğŸ¨ UIå®Ÿè£…

### ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‹•ç”»ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦é–‹å§‹              â”‚
â”‚  æ•°åˆ†ã§è©³ç´°ãªè§£æçµæœã¨ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’...   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠ                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ VFçŸ¢æ²»                        â–¼ â”‚ â”‚ â† ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     ğŸ“¹ å‹•ç”»ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—    â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹å¾´**:
- ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³å½¢å¼ã§é¸æŠ
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤: `VFçŸ¢æ²»` (vf_yaji)
- è¡¨ç¤ºå: æ—¥æœ¬èªåï¼ˆä¾‹: VFçŸ¢æ²»ï¼‰
- é€ä¿¡å€¤: è‹±æ•°å­—IDï¼ˆä¾‹: vf_yajiï¼‰

---

## ğŸ”§ æŠ€è¡“å®Ÿè£…

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆPostgreSQLï¼‰

**usersãƒ†ãƒ¼ãƒ–ãƒ«**:
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(255) UNIQUE NOT NULL,  -- ä¾‹: vf_yaji
    username VARCHAR(255),                  -- ä¾‹: VFçŸ¢æ²»
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

**runsãƒ†ãƒ¼ãƒ–ãƒ«**:
```sql
CREATE TABLE runs (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,         -- usersãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‚ç…§
    video_id VARCHAR(255) UNIQUE NOT NULL,
    ...
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
);
```

### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆNext.js + TypeScriptï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/app/page.tsx`

**Stateç®¡ç†**:
```typescript
const [selectedUser, setSelectedUser] = useState<string>('vf_yaji')

const users = [
  { id: 'vf_yaji', name: 'VFçŸ¢æ²»' },
  { id: 'vf_ono', name: 'VFå¤§é‡' },
  // ...
]
```

**FormDataé€ä¿¡**:
```typescript
const formData = new FormData()
formData.append('file', selectedFile)
formData.append('user_id', selectedUser)  // â† ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’è¿½åŠ 
```

### 3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆFastAPI + Pythonï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/services/video_processing/app/main.py`

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
```python
@app.post("/upload")
async def upload_video(
    file: UploadFile = File(...),
    user_id: str = Form("default_user"),  # â† è¿½åŠ 
    prompt_settings: Optional[str] = Form(None)
):
```

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**:
```python
valid_users = [
    "vf_yaji", "vf_ono", "vf_hirokawa",
    "x_ae", "x_masuda", "x_komatsu", "x_suzuki", "x_konno",
    "guest1", "guest2", "guest3", "guest4", "guest5",
    "default_user"
]

if user_id not in valid_users:
    logger.warning(f"âš ï¸ ç„¡åŠ¹ãªuser_id: {user_id}, default_userã‚’ä½¿ç”¨")
    user_id = "default_user"
```

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜**:
```python
run_id = create_run_record(
    video_id=unique_id,
    user_id=user_id,  # â† é¸æŠã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ä¿å­˜
    video_path=str(file_path),
    # ...
)
```

---

## ğŸ“ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `setup_users.py`

**æ©Ÿèƒ½**:
- 14åã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¸€æ‹¬ç™»éŒ²
- æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ›´æ–°ï¼ˆON CONFLICT DO UPDATEï¼‰
- ãƒ­ãƒ¼ã‚«ãƒ«ã¨EC2ã®ä¸¡æ–¹ã§å®Ÿè¡Œå¯èƒ½

**å®Ÿè¡Œæ–¹æ³•**:
```bash
# ãƒ­ãƒ¼ã‚«ãƒ«
docker compose cp setup_users.py video_processing:/app/setup_users.py
docker compose exec video_processing python3 /app/setup_users.py

# EC2
docker-compose cp setup_users.py video_processing:/app/setup_users.py
docker-compose exec video_processing python3 /app/setup_users.py
```

**å‡ºåŠ›ä¾‹**:
```
============================================================
ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‚¹ã‚¯ãƒªãƒ—ãƒˆé–‹å§‹
============================================================

ğŸ“Š æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼: 1å
   - default_user: Default User

âœ… æ–°è¦ç™»éŒ²: vf_yaji (VFçŸ¢æ²»)
âœ… æ–°è¦ç™»éŒ²: vf_ono (VFå¤§é‡)
...

============================================================
ğŸ“Š ç™»éŒ²çµæœ
============================================================
âœ… æ–°è¦ç™»éŒ²: 13å
ğŸ”„ æ›´æ–°: 1å
ğŸ“ åˆè¨ˆ: 14å

ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: 14å
```

---

## ğŸ” ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèªæ–¹æ³•

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã®ç¢ºèª

```bash
docker compose exec video_processing python3 << 'PYTHON'
import psycopg2, os
from dotenv import load_dotenv

load_dotenv()
conn = psycopg2.connect(
    host=os.getenv("DB_HOST"),
    port=os.getenv("DB_PORT"),
    database=os.getenv("DB_NAME"),
    user=os.getenv("DB_USER"),
    password=os.getenv("DB_PASSWORD")
)
cursor = conn.cursor()
cursor.execute("SELECT user_id, username FROM users ORDER BY user_id")
for user_id, username in cursor.fetchall():
    print(f"{user_id:20s} â†’ {username}")
PYTHON
```

### æœ€æ–°ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è¨˜éŒ²ã®ç¢ºèª

```bash
docker compose exec video_processing python3 << 'PYTHON'
import psycopg2, os
from dotenv import load_dotenv

load_dotenv()
conn = psycopg2.connect(
    host=os.getenv("DB_HOST"),
    port=os.getenv("DB_PORT"),
    database=os.getenv("DB_NAME"),
    user=os.getenv("DB_USER"),
    password=os.getenv("DB_PASSWORD")
)
cursor = conn.cursor()
cursor.execute("""
    SELECT r.id, r.user_id, u.username, r.video_id, r.created_at
    FROM runs r
    JOIN users u ON r.user_id = u.user_id
    ORDER BY r.created_at DESC
    LIMIT 5
""")
for run_id, user_id, username, video_id, created_at in cursor.fetchall():
    print(f"Run #{run_id}: {username} ({user_id}) - {created_at}")
PYTHON
```

---

## âœ… ãƒ†ã‚¹ãƒˆæ‰‹é †

### 1. ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ãƒ†ã‚¹ãƒˆ

1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:3000` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã§ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠï¼ˆä¾‹: VFå¤§é‡ï¼‰
3. å‹•ç”»ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç¢ºèª:
   ```bash
   docker compose exec video_processing python3 -c "
   import psycopg2, os
   from dotenv import load_dotenv
   load_dotenv()
   conn = psycopg2.connect(
       host=os.getenv('DB_HOST'),
       port=os.getenv('DB_PORT'),
       database=os.getenv('DB_NAME'),
       user=os.getenv('DB_USER'),
       password=os.getenv('DB_PASSWORD')
   )
   cursor = conn.cursor()
   cursor.execute('SELECT user_id, video_id FROM runs ORDER BY created_at DESC LIMIT 1')
   print(cursor.fetchone())
   "
   ```
5. é¸æŠã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

### 2. EC2æœ¬ç•ªç’°å¢ƒã§ãƒ†ã‚¹ãƒˆ

1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://54.206.3.155` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. Basicèªè¨¼ï¼ˆID: xebio, PW: 20251001ï¼‰
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã§ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ
4. å‹•ç”»ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
5. EC2ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç¢ºèªï¼ˆä¸Šè¨˜ã¨åŒã˜ã‚³ãƒãƒ³ãƒ‰ï¼‰

---

## ğŸ“¦ ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ç’°å¢ƒ

### ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: 14åç™»éŒ²æ¸ˆã¿
- âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠUIå®Ÿè£…æ¸ˆã¿
- âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: user_idå—ã‘å–ã‚Šãƒ»æ¤œè¨¼ãƒ»ä¿å­˜å®Ÿè£…æ¸ˆã¿

### EC2æœ¬ç•ªç’°å¢ƒ
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: 14åç™»éŒ²æ¸ˆã¿
- âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠUIå®Ÿè£…æ¸ˆã¿
- âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: user_idå—ã‘å–ã‚Šãƒ»æ¤œè¨¼ãƒ»ä¿å­˜å®Ÿè£…æ¸ˆã¿
- âœ… ã‚µã‚¤ãƒˆURL: http://54.206.3.155

---

## ğŸ”„ ä»Šå¾Œã®ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ æ–¹æ³•

### æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã™ã‚‹å ´åˆ

1. **setup_users.py ã‚’ç·¨é›†**:
   ```python
   USERS = [
       # ... æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ ...
       ("new_user_id", "æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼å"),  # â† è¿½åŠ 
   ]
   ```

2. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ç·¨é›†** (`frontend/app/page.tsx`):
   ```typescript
   const users = [
       // ... æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ ...
       { id: 'new_user_id', name: 'æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼å' },  // â† è¿½åŠ 
   ]
   ```

3. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ç·¨é›†** (`backend/services/video_processing/app/main.py`):
   ```python
   valid_users = [
       # ... æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ ...
       "new_user_id",  # â† è¿½åŠ 
   ]
   ```

4. **ãƒ‡ãƒ—ãƒ­ã‚¤**:
   ```bash
   # ã‚³ãƒŸãƒƒãƒˆ
   git add setup_users.py frontend/app/page.tsx backend/services/video_processing/app/main.py
   git commit -m "Add new user: æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼å"
   git push origin main
   
   # EC2ã«ãƒ‡ãƒ—ãƒ­ã‚¤
   ssh ec2-user@54.206.3.155
   cd ~/running-analysis-system
   git pull origin main
   docker-compose build frontend video_processing
   docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d --force-recreate
   docker-compose cp setup_users.py video_processing:/app/setup_users.py
   docker-compose exec video_processing python3 /app/setup_users.py
   ```

---

## ğŸ‰ å®Œäº†

ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠæ©Ÿèƒ½ãŒå®Œå…¨ã«å®Ÿè£…ã•ã‚Œã€ãƒ­ãƒ¼ã‚«ãƒ«ã¨EC2ã®ä¸¡æ–¹ã§ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã—ã¾ã—ãŸã€‚

**å‹•ä½œç¢ºèª**: http://54.206.3.155

ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼
