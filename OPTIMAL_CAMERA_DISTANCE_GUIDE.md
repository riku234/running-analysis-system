# トレッドミル動画解析における最適な撮影距離ガイド

## 概要

MediaPipe Poseを使用した骨格推定の精度を最大化するための、トレッドミルマシンでの最適な撮影距離について説明します。

---

## 推奨撮影距離

### 横から撮影（サイドビュー）の場合

#### **最適距離: 3-5メートル**

**理由:**
- MediaPipe Poseは、人物がフレームの**50-80%**を占める場合に最も精度が高い
- 全身のキーポイント（33個）がすべて検出可能な距離
- 体幹角度、大腿角度、下腿角度の計算に必要な精度を確保

**詳細:**
- **最小距離: 2.5メートル** - 全身がフレームに収まり、キーポイントが十分な解像度で検出される
- **最適距離: 3-4メートル** - バランスが最も良い距離（推奨）
- **最大距離: 5-6メートル** - それ以上離れるとキーポイントの検出精度が低下

### 背後から撮影（バックビュー）の場合

#### **最適距離: 5-7メートル**

**理由:**
- 横から撮影より広い視野が必要
- ランナーの全身とトレッドミル全体がフレームに収まる必要がある

---

## カメラ解像度別の推奨距離

### 1080p (1920×1080) の場合
- **横から撮影**: 3-4メートル（推奨）
- **背後から撮影**: 5-6メートル（推奨）

### 4K (3840×2160) の場合
- **横から撮影**: 4-6メートル（より遠くからでも高精度）
- **背後から撮影**: 6-8メートル（より遠くからでも高精度）

### 720p (1280×720) の場合
- **横から撮影**: 2.5-3.5メートル（近距離推奨）
- **背後から撮影**: 4-5メートル（近距離推奨）

---

## 現在のシステムの特性

### MediaPipe Pose設定
```python
model_complexity=2,  # 最高精度モデル
min_detection_confidence=0.2,  # 低閾値で検出率最大化
min_tracking_confidence=0.2  # 低閾値でトラッキング安定性最大化
```

### 画像前処理
- **解像度スケーリング**: 小さい動画（640px未満）は自動的にスケールアップ
- **ノイズ除去**: ガウシアンブラー、バイラテラルフィルター
- **コントラスト調整**: CLAHE（clipLimit=3.0）
- **シャープ化**: エッジ強調処理

**これらの前処理により、やや遠距離からの撮影でも精度を維持できます。**

---

## 距離計算の目安

### ランナーの身長を基準とした計算

**一般的な目安:**
- **最小距離** = ランナーの身長 × 1.5倍
- **最適距離** = ランナーの身長 × 2-2.5倍
- **最大距離** = ランナーの身長 × 3倍

**例: 身長170cmのランナーの場合**
- 最小距離: 2.5メートル
- 最適距離: 3.5-4.5メートル
- 最大距離: 5メートル

### フレーム内の人物サイズチェック

**理想的な人物のサイズ:**
- フレームの高さの**60-80%**を人物が占める
- 頭から足首までが完全にフレーム内に収まる
- 左右に適度な余白がある（10-20%）

---

## 角度計算精度への影響

### 体幹角度（Trunk Angle）
- **必要な精度**: キーポイント間の距離が十分に大きい必要がある
- **推奨距離**: 3-4メートル（横から撮影）
- **精度低下**: 5メートル以上で角度計算の誤差が増加

### 大腿角度（Thigh Angle）
- **必要な精度**: 股関節-膝関節間の距離が重要
- **推奨距離**: 3-4メートル（横から撮影）
- **精度低下**: 遠距離では膝関節の検出精度が低下

### 下腿角度（Shank Angle）
- **必要な精度**: 膝関節-足首間の距離が重要（最も小さい）
- **推奨距離**: 3-4メートル（横から撮影）
- **精度低下**: 遠距離では足首の検出精度が最も低下しやすい

---

## 実践的な撮影設定

### セットアップ手順

1. **カメラの高さ**
   - ランナーの**腰の高さ**にカメラを設置（横から撮影）
   - または、ランナーの**頭の高さ**にカメラを設置（より自然な視点）

2. **カメラ角度**
   - **横から撮影**: カメラをランナーに対して**90度**（真横）
   - **背後から撮影**: カメラをランナーに対して**180度**（真後ろ）

3. **距離の調整**
   - まず**3メートル**から開始
   - ランナーの全身がフレームに収まることを確認
   - 必要に応じて距離を調整（近すぎる場合は遠くへ、遠すぎる場合は近くへ）

4. **解像度の確認**
   - 1080p以上を推奨
   - 4Kが使用可能な場合は、より遠距離からでも高精度

### 撮影時の注意点

- **照明**: 十分な明るさを確保（暗いと検出精度が低下）
- **背景**: ランナーと背景のコントラストを確保
- **固定**: カメラを三脚などで固定（手ブレを防止）
- **フレーミング**: ランナーが常にフレーム中央に位置するように調整

---

## システムの自動補正機能

現在のシステムには以下の自動補正機能が実装されています：

1. **解像度スケーリング**: 小さい動画は自動的に640px以上にスケールアップ
2. **画像前処理**: ノイズ除去、コントラスト調整、シャープ化により精度向上
3. **スムージング**: 5フレームの移動平均により、キーポイントの揺れを低減
4. **構造的制約**: 膝-足首の位置関係チェックにより、異常値を補正

**これらの機能により、やや最適距離から外れていても、ある程度の精度を維持できます。**

---

## まとめ

### 横から撮影（推奨）
- **最適距離: 3-4メートル**
- **許容範囲: 2.5-5メートル**
- **カメラ高さ: 腰の高さまたは頭の高さ**
- **解像度: 1080p以上推奨**

### 背後から撮影
- **最適距離: 5-6メートル**
- **許容範囲: 4-7メートル**
- **カメラ高さ: 頭の高さ**
- **解像度: 1080p以上推奨**

### 重要なポイント
1. **ランナーの全身がフレームに収まること**
2. **フレームの60-80%を人物が占めること**
3. **十分な照明とコントラストを確保すること**
4. **カメラを固定して手ブレを防止すること**

これらの条件を満たすことで、MediaPipe Poseによる骨格推定の精度を最大化できます。

