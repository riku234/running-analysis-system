# ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰
FROM node:18-alpine AS frontend-builder

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰
WORKDIR /app/frontend
COPY ../../frontend/package*.json ./
RUN npm ci --only=production

COPY ../../frontend/ ./
RUN npm run build

# Nginxæœ¬ä½“
FROM nginx:1.25-alpine

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Nginxè¨­å®šã‚’å‰Šé™¤
RUN rm /etc/nginx/conf.d/default.conf

# HTMLãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç¢ºå®Ÿã«ä½œæˆã—ã€åŸºæœ¬çš„ãªindex.htmlã‚’ä½œæˆ
RUN mkdir -p /usr/share/nginx/html && \
    echo '<!DOCTYPE html><html><head><title>Running Analysis System</title><meta charset="utf-8"></head><body><h1>ğŸƒâ€â™‚ï¸ Running Analysis System</h1><p>ã‚·ã‚¹ãƒ†ãƒ ã‚’èª­ã¿è¾¼ã¿ä¸­...</p><p>ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚</p></body></html>' > /usr/share/nginx/html/index.html

# Nginxè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
COPY nginx.conf /etc/nginx/nginx.conf

# ãƒãƒ¼ãƒˆã‚’å…¬é–‹
EXPOSE 80

# Nginxã‚’èµ·å‹•
CMD ["nginx", "-g", "daemon off;"] 