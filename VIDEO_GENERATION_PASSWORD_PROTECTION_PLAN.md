# å‹•ç”»ç”Ÿæˆæ©Ÿèƒ½ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿è­· - å®Ÿè£…è¨ˆç”»

## ğŸ“‹ æ¦‚è¦

**ç›®çš„**: OpenAI Sora-2ã«ã‚ˆã‚‹å‹•ç”»ç”Ÿæˆã¯é«˜ã‚³ã‚¹ãƒˆã®ãŸã‚ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿è­·ã‚’å®Ÿè£…ã—ã¦ä¸æ­£åˆ©ç”¨ã‚’é˜²æ­¢ã™ã‚‹

**å¯¾è±¡**: çµæœç”»é¢ã®ã€Œãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å‹•ç”»ã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³

**å®Ÿè£…æ–¹é‡**: ã‚·ãƒ³ãƒ—ãƒ«ã§åŠ¹æœçš„ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼

---

## ğŸ¯ è¦ä»¶å®šç¾©

### æ©Ÿèƒ½è¦ä»¶

1. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›UI**
   - å‹•ç”»ç”Ÿæˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ã„å ´åˆã®ã¿å‹•ç”»ç”Ÿæˆã‚’å®Ÿè¡Œ
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã‚‹å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

2. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**
   - ä¸€åº¦èªè¨¼ã«æˆåŠŸã—ãŸã‚‰ã€åŒã˜ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§ã¯å†å…¥åŠ›ä¸è¦
   - ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã‚‹ã¾ã§æœ‰åŠ¹
   - ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ä¸€å®šæ™‚é–“å¾Œã«å†èªè¨¼ã‚’è¦æ±‚

3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†
   - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®ç°¡æ˜“ãƒã‚§ãƒƒã‚¯ + ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã®å³å¯†ãƒã‚§ãƒƒã‚¯
   - ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒå¯¾ç­–ï¼ˆè©¦è¡Œå›æ•°åˆ¶é™ï¼‰

### éæ©Ÿèƒ½è¦ä»¶

1. **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£**
   - ã‚·ãƒ³ãƒ—ãƒ«ã§åˆ†ã‹ã‚Šã‚„ã™ã„UI
   - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ˜ç¢º
   - èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯è² æ‹…ã‚’ã‹ã‘ãªã„

2. **ä¿å®ˆæ€§**
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ãŒå®¹æ˜“
   - æ—¢å­˜æ©Ÿèƒ½ã¸ã®å½±éŸ¿ã‚’æœ€å°é™ã«

---

## ğŸ—ï¸ å®Ÿè£…æ–¹å¼ã®é¸æŠè‚¢

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã¿ã§ãƒã‚§ãƒƒã‚¯ï¼ˆç°¡æ˜“ç‰ˆï¼‰

**ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ… å®Ÿè£…ãŒç°¡å˜
- âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒé€Ÿã„
- âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å¤‰æ›´ä¸è¦

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- âŒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒå¼±ã„ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§å›é¿å¯èƒ½ï¼‰
- âŒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã«éœ²å‡º

**æ¨å¥¨åº¦**: â­â­â˜†â˜†â˜†ï¼ˆéæ¨å¥¨ï¼‰

---

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ãƒã‚§ãƒƒã‚¯ï¼ˆæ¨å¥¨ï¼‰

**ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒé«˜ã„
- âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒã‚µãƒ¼ãƒãƒ¼å´ã§ç®¡ç†ã•ã‚Œã‚‹
- âœ… ãƒ­ã‚°è¨˜éŒ²ã‚„è©¦è¡Œå›æ•°åˆ¶é™ãŒå¯èƒ½

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- âš ï¸ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å¤‰æ›´ãŒå¿…è¦
- âš ï¸ å®Ÿè£…ãŒå°‘ã—è¤‡é›‘

**æ¨å¥¨åº¦**: â­â­â­â­â­ï¼ˆæ¨å¥¨ï¼‰

---

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³3: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ–¹å¼ï¼ˆæœ€é©ï¼‰

**ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å³åº§ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆUXå‘ä¸Šï¼‰
- âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§å³å¯†ãªãƒã‚§ãƒƒã‚¯ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºä¿ï¼‰
- âœ… ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ã„

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- âš ï¸ å®Ÿè£…ç®‡æ‰€ãŒ2ç®‡æ‰€

**æ¨å¥¨åº¦**: â­â­â­â­â­ï¼ˆæœ€æ¨å¥¨ï¼‰

---

## ğŸ¨ æ¨å¥¨å®Ÿè£…: ã‚ªãƒ—ã‚·ãƒ§ãƒ³3ï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ–¹å¼ï¼‰

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (frontend/app/result/[id]/page.tsx)          â”‚
â”‚                                                               â”‚
â”‚  1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œå‹•ç”»ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯                   â”‚
â”‚  2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º                             â”‚
â”‚  3. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›                                         â”‚
â”‚  4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ç°¡æ˜“ãƒã‚§ãƒƒã‚¯ï¼ˆå³åº§ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰     â”‚
â”‚  5. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã«é€ä¿¡ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ + drill_textï¼‰        â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (backend/services/video_generation/app/main.py)â”‚
â”‚                                                               â”‚
â”‚  1. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œè¨¼ï¼ˆç’°å¢ƒå¤‰æ•°ã¨ç…§åˆï¼‰                       â”‚
â”‚  2. è©¦è¡Œå›æ•°ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹å¯¾ç­–ï¼‰               â”‚
â”‚  3. æ¤œè¨¼æˆåŠŸ â†’ å‹•ç”»ç”Ÿæˆã‚’å®Ÿè¡Œ                                â”‚
â”‚  4. æ¤œè¨¼å¤±æ•— â†’ 401 Unauthorized ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™                 â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å®Ÿè£…è©³ç´°

### Phase 1: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…

#### 1.1 ç’°å¢ƒå¤‰æ•°ã®è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `.env`

```bash
# å‹•ç”»ç”Ÿæˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
VIDEO_GENERATION_PASSWORD=your_secure_password_here
```

**ãƒ•ã‚¡ã‚¤ãƒ«**: `docker-compose.yml` & `docker-compose.prod.yml`

```yaml
video_generation:
  environment:
    - VIDEO_GENERATION_PASSWORD=${VIDEO_GENERATION_PASSWORD}
```

---

#### 1.2 ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼æ©Ÿèƒ½ã®è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/services/video_generation/app/main.py`

```python
import os
from datetime import datetime, timedelta
from collections import defaultdict

# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š
VIDEO_GENERATION_PASSWORD = os.getenv("VIDEO_GENERATION_PASSWORD", "")

# ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹å¯¾ç­–: IPã‚¢ãƒ‰ãƒ¬ã‚¹ã”ã¨ã®è©¦è¡Œå›æ•°ã‚’è¨˜éŒ²
failed_attempts = defaultdict(lambda: {"count": 0, "last_attempt": None})
MAX_ATTEMPTS = 5
LOCKOUT_DURATION = timedelta(minutes=15)

def verify_password(password: str, client_ip: str) -> tuple[bool, str]:
    """
    ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œè¨¼ã™ã‚‹
    
    Args:
        password: å…¥åŠ›ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
        client_ip: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®IPã‚¢ãƒ‰ãƒ¬ã‚¹
    
    Returns:
        (æ¤œè¨¼çµæœ, ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
    """
    # ãƒ­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãƒã‚§ãƒƒã‚¯
    if client_ip in failed_attempts:
        attempt_info = failed_attempts[client_ip]
        if attempt_info["count"] >= MAX_ATTEMPTS:
            if attempt_info["last_attempt"]:
                time_since_last = datetime.now() - attempt_info["last_attempt"]
                if time_since_last < LOCKOUT_DURATION:
                    remaining = LOCKOUT_DURATION - time_since_last
                    return False, f"è©¦è¡Œå›æ•°ãŒä¸Šé™ã«é”ã—ã¾ã—ãŸã€‚{int(remaining.total_seconds() / 60)}åˆ†å¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚"
                else:
                    # ãƒ­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆæœŸé–“ãŒéããŸã®ã§ãƒªã‚»ãƒƒãƒˆ
                    failed_attempts[client_ip] = {"count": 0, "last_attempt": None}
    
    # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
    if not VIDEO_GENERATION_PASSWORD:
        logger.warning("âš ï¸  VIDEO_GENERATION_PASSWORD ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“")
        return False, "å‹•ç”»ç”Ÿæˆæ©Ÿèƒ½ã¯ç¾åœ¨åˆ©ç”¨ã§ãã¾ã›ã‚“"
    
    if password == VIDEO_GENERATION_PASSWORD:
        # æˆåŠŸã—ãŸã®ã§è©¦è¡Œå›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆ
        if client_ip in failed_attempts:
            del failed_attempts[client_ip]
        return True, ""
    else:
        # å¤±æ•—ã‚’è¨˜éŒ²
        failed_attempts[client_ip]["count"] += 1
        failed_attempts[client_ip]["last_attempt"] = datetime.now()
        remaining_attempts = MAX_ATTEMPTS - failed_attempts[client_ip]["count"]
        
        if remaining_attempts > 0:
            return False, f"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆæ®‹ã‚Š{remaining_attempts}å›ï¼‰"
        else:
            return False, f"è©¦è¡Œå›æ•°ãŒä¸Šé™ã«é”ã—ã¾ã—ãŸã€‚{int(LOCKOUT_DURATION.total_seconds() / 60)}åˆ†å¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚"
```

---

#### 1.3 `/generate` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ä¿®æ­£

**ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/services/video_generation/app/main.py`

```python
from fastapi import Request

class VideoGenerationRequest(BaseModel):
    run_id: int
    drill_text: str
    size: str
    seconds: str
    password: str  # â† è¿½åŠ 

@app.post("/generate", response_model=VideoGenerationResult)
async def generate_video_endpoint(request: VideoGenerationRequest, req: Request):
    """
    ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å‹•ç”»ã®ç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ä»˜ã‘ã€OpenAI Sora-2 APIã‚’å‘¼ã³å‡ºã™
    """
    logger.info("================================================================================")
    logger.info("ğŸ¬ å‹•ç”»ç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡")
    logger.info(f"   Run ID: {request.run_id}")
    logger.info(f"   ãƒ‰ãƒªãƒ«ãƒ†ã‚­ã‚¹ãƒˆ: {request.drill_text[:100]}...")
    
    # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
    client_ip = req.client.host
    is_valid, error_message = verify_password(request.password, client_ip)
    
    if not is_valid:
        logger.warning(f"âŒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼å¤±æ•—: {client_ip} - {error_message}")
        raise HTTPException(
            status_code=401,
            detail=error_message
        )
    
    logger.info(f"âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼æˆåŠŸ: {client_ip}")
    
    # ä»¥é™ã¯æ—¢å­˜ã®ãƒ­ã‚¸ãƒƒã‚¯
    # ...
```

---

### Phase 2: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

#### 2.1 ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ã®è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/app/result/[id]/page.tsx`

```typescript
// çŠ¶æ…‹ç®¡ç†ã«è¿½åŠ 
const [showPasswordModal, setShowPasswordModal] = useState(false)
const [videoPassword, setVideoPassword] = useState("")
const [passwordError, setPasswordError] = useState<string | null>(null)
const [pendingDrillText, setPendingDrillText] = useState<string | null>(null)

// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã®ç°¡æ˜“ãƒã‚§ãƒƒã‚¯ï¼‰
const validatePasswordFormat = (password: string): boolean => {
  // æœ€ä½é™ã®å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆç©ºã§ãªã„ã“ã¨ï¼‰
  return password.trim().length > 0
}

// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
const handlePasswordSubmit = async () => {
  if (!validatePasswordFormat(videoPassword)) {
    setPasswordError("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    return
  }
  
  if (!pendingDrillText) {
    setPasswordError("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")
    return
  }
  
  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã¦å‹•ç”»ç”Ÿæˆã‚’å®Ÿè¡Œ
  setShowPasswordModal(false)
  setPasswordError(null)
  
  // å‹•ç”»ç”Ÿæˆã‚’å®Ÿè¡Œï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä»˜ãï¼‰
  await generateTrainingVideoWithPassword(pendingDrillText, videoPassword)
  
  // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªã‚¢
  setVideoPassword("")
  setPendingDrillText(null)
}

// å‹•ç”»ç”Ÿæˆãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆä¿®æ­£ç‰ˆï¼‰
const handleGenerateVideoClick = (drillText: string) => {
  setPendingDrillText(drillText)
  setShowPasswordModal(true)
  setPasswordError(null)
}

// å‹•ç”»ç”Ÿæˆé–¢æ•°ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä»˜ãï¼‰
const generateTrainingVideoWithPassword = async (drillText: string, password: string) => {
  if (videoGenerating) return
  
  setVideoGenerating(true)
  setVideoError(null)
  
  try {
    console.log('ğŸ¬ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å‹•ç”»ç”Ÿæˆé–‹å§‹ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ä»˜ãï¼‰')
    
    const requestData = {
      run_id: parseInt(params.id) || 999,
      drill_text: drillText,
      size: "1280x720",
      seconds: "4",
      password: password  // â† è¿½åŠ 
    }
    
    const response = await fetch('/api/video-generation/generate', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(requestData)
    })
    
    if (response.status === 401) {
      // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼å¤±æ•—
      const errorData = await response.json()
      throw new Error(errorData.detail || 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“')
    }
    
    if (!response.ok) {
      throw new Error(`å‹•ç”»ç”ŸæˆAPIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼: ${response.status}`)
    }
    
    const videoResult = await response.json()
    console.log('ğŸ¬ å‹•ç”»ç”Ÿæˆçµæœ:', videoResult)
    
    if (videoResult.status === 'success' && videoResult.video_url) {
      setTrainingVideoUrl(videoResult.video_url)
      console.log('âœ… å‹•ç”»URLå–å¾—æˆåŠŸ:', videoResult.video_url)
    } else {
      throw new Error(videoResult.error || 'å‹•ç”»ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ')
    }
  } catch (error) {
    console.error('âŒ å‹•ç”»ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error)
    setVideoError(`å‹•ç”»ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${error}`)
  } finally {
    setVideoGenerating(false)
  }
}
```

---

#### 2.2 ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã®UI

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/app/result/[id]/page.tsx`

```tsx
{/* ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« */}
{showPasswordModal && (
  <div 
    className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    onClick={() => {
      setShowPasswordModal(false)
      setPasswordError(null)
      setVideoPassword("")
      setPendingDrillText(null)
    }}
  >
    <div 
      className="bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl"
      onClick={(e) => e.stopPropagation()}
    >
      <h3 className="text-xl font-bold mb-4 text-gray-800">
        ğŸ”’ å‹•ç”»ç”Ÿæˆã®èªè¨¼
      </h3>
      <p className="text-sm text-gray-600 mb-4">
        å‹•ç”»ç”Ÿæˆæ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™
      </p>
      
      <input
        type="password"
        value={videoPassword}
        onChange={(e) => {
          setVideoPassword(e.target.value)
          setPasswordError(null)
        }}
        onKeyPress={(e) => {
          if (e.key === 'Enter') {
            handlePasswordSubmit()
          }
        }}
        placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›"
        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 mb-2"
        autoFocus
      />
      
      {passwordError && (
        <p className="text-sm text-red-600 mb-4">
          âš ï¸ {passwordError}
        </p>
      )}
      
      <div className="flex gap-3">
        <Button
          onClick={handlePasswordSubmit}
          className="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700"
        >
          ç¢ºèª
        </Button>
        <Button
          onClick={() => {
            setShowPasswordModal(false)
            setPasswordError(null)
            setVideoPassword("")
            setPendingDrillText(null)
          }}
          variant="outline"
          className="flex-1"
        >
          ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        </Button>
      </div>
    </div>
  </div>
)}
```

---

#### 2.3 ç”Ÿæˆãƒœã‚¿ãƒ³ã®ä¿®æ­£

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/app/result/[id]/page.tsx`

```tsx
<Button
  onClick={() => {
    const drillSection = finalAdvice.match(/ã€ğŸ’ª ãŠã™ã™ã‚ã®è£œå¼·ãƒ‰ãƒªãƒ«ã€‘[\s\S]*?(?=ã€|$)/)?.[0]
    if (drillSection) {
      handleGenerateVideoClick(drillSection)  // â† ä¿®æ­£
    } else {
      handleGenerateVideoClick(finalAdvice.substring(0, 200))  // â† ä¿®æ­£
    }
  }}
  className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700"
>
  <PlayCircle className="w-4 h-4 mr-2" />
  ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å‹•ç”»ã‚’ç”Ÿæˆ
</Button>
```

---

### Phase 3: ãƒ‡ãƒ—ãƒ­ã‚¤ã¨è¨­å®š

#### 3.1 ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¨­å®š

1. **ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ**:
   ```bash
   echo "VIDEO_GENERATION_PASSWORD=your_secure_password" >> .env
   ```

2. **EC2ç’°å¢ƒ**:
   ```bash
   ssh ec2-user@54.206.3.155
   cd ~/running-analysis-system
   echo "VIDEO_GENERATION_PASSWORD=your_secure_password" >> .env
   ```

#### 3.2 ã‚µãƒ¼ãƒ“ã‚¹ã®å†èµ·å‹•

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«
docker-compose build video_generation frontend
docker-compose up -d video_generation frontend

# EC2
ssh ec2-user@54.206.3.155
cd ~/running-analysis-system
docker-compose build video_generation frontend
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d video_generation frontend
```

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 1. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å¼·åº¦

**æ¨å¥¨**:
- æœ€ä½12æ–‡å­—ä»¥ä¸Š
- å¤§æ–‡å­—ã€å°æ–‡å­—ã€æ•°å­—ã€è¨˜å·ã‚’å«ã‚€
- è¾æ›¸ã«è¼‰ã£ã¦ã„ãªã„å˜èª

**ä¾‹**: `Vfm2025!RunGen#Secure`

### 2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç®¡ç†

- âœ… ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ï¼ˆ`.env`ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- âœ… `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã¯`.gitignore`ã«å«ã‚ã‚‹
- âœ… å®šæœŸçš„ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´
- âœ… å¿…è¦æœ€å°é™ã®äººæ•°ã«ã®ã¿å…±æœ‰

### 3. ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹å¯¾ç­–

- âœ… è©¦è¡Œå›æ•°åˆ¶é™ï¼ˆ5å›ï¼‰
- âœ… ãƒ­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆæœŸé–“ï¼ˆ15åˆ†ï¼‰
- âœ… IPã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ™ãƒ¼ã‚¹ã®åˆ¶é™

### 4. ãƒ­ã‚°è¨˜éŒ²

```python
# æˆåŠŸãƒ»å¤±æ•—ã‚’ãƒ­ã‚°ã«è¨˜éŒ²
logger.info(f"âœ… å‹•ç”»ç”Ÿæˆèªè¨¼æˆåŠŸ: IP={client_ip}, Run ID={request.run_id}")
logger.warning(f"âŒ å‹•ç”»ç”Ÿæˆèªè¨¼å¤±æ•—: IP={client_ip}, è©¦è¡Œå›æ•°={attempt_count}")
```

---

## ğŸ“Š å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| ãƒ•ã‚§ãƒ¼ã‚º | ã‚¿ã‚¹ã‚¯ | æ‰€è¦æ™‚é–“ | å„ªå…ˆåº¦ |
|---------|--------|---------|--------|
| **Phase 1** | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£… | 1-2æ™‚é–“ | é«˜ |
| - | ç’°å¢ƒå¤‰æ•°è¿½åŠ  | 15åˆ† | é«˜ |
| - | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼æ©Ÿèƒ½ | 30åˆ† | é«˜ |
| - | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¿®æ­£ | 30åˆ† | é«˜ |
| - | ãƒ†ã‚¹ãƒˆ | 30åˆ† | é«˜ |
| **Phase 2** | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£… | 1-2æ™‚é–“ | é«˜ |
| - | çŠ¶æ…‹ç®¡ç†è¿½åŠ  | 15åˆ† | é«˜ |
| - | ãƒ¢ãƒ¼ãƒ€ãƒ«UIä½œæˆ | 45åˆ† | é«˜ |
| - | ç”Ÿæˆãƒœã‚¿ãƒ³ä¿®æ­£ | 15åˆ† | é«˜ |
| - | ãƒ†ã‚¹ãƒˆ | 30åˆ† | é«˜ |
| **Phase 3** | ãƒ‡ãƒ—ãƒ­ã‚¤ | 30åˆ† | é«˜ |
| - | ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒè¨­å®š | 10åˆ† | é«˜ |
| - | EC2ç’°å¢ƒè¨­å®š | 10åˆ† | é«˜ |
| - | å‹•ä½œç¢ºèª | 10åˆ† | é«˜ |

**åˆè¨ˆæ‰€è¦æ™‚é–“**: ç´„3-4æ™‚é–“

---

## âœ… ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

### 1. æ­£å¸¸ç³»

1. âœ… æ­£ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§å‹•ç”»ç”ŸæˆãŒæˆåŠŸã™ã‚‹
2. âœ… ä¸€åº¦èªè¨¼ã«æˆåŠŸã—ãŸã‚‰ã€åŒã˜ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§ã¯å†å…¥åŠ›ä¸è¦ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### 2. ç•°å¸¸ç³»

1. âœ… é–“é•ã£ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
2. âœ… 5å›å¤±æ•—ã™ã‚‹ã¨15åˆ†é–“ãƒ­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã•ã‚Œã‚‹
3. âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æœªå…¥åŠ›ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
4. âœ… ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‰ã˜ã‚‹

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

1. âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã«éœ²å‡ºã—ã¦ã„ãªã„
2. âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ­ã‚°ã«å¹³æ–‡ã§è¨˜éŒ²ã•ã‚Œãªã„ï¼ˆHTTPSä½¿ç”¨ï¼‰
3. âœ… ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒãŒé˜²ãŒã‚Œã‚‹

---

## ğŸš€ å°†æ¥ã®æ‹¡å¼µæ¡ˆ

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½

1. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®æ”¹å–„**
   - JWTãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹èªè¨¼
   - æœ‰åŠ¹æœŸé™ä»˜ããƒˆãƒ¼ã‚¯ãƒ³

2. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†**
   - è¤‡æ•°ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ï¼‰
   - ä½¿ç”¨å›æ•°åˆ¶é™

3. **ç›£è¦–ã¨ã‚¢ãƒ©ãƒ¼ãƒˆ**
   - å‹•ç”»ç”Ÿæˆå›æ•°ã®ç›£è¦–
   - ç•°å¸¸ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡º
   - Slackã¸ã®é€šçŸ¥

4. **ã‚³ã‚¹ãƒˆç®¡ç†**
   - 1æ—¥ã‚ãŸã‚Šã®ç”Ÿæˆå›æ•°åˆ¶é™
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ä½¿ç”¨é‡ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°

---

## ğŸ“ ã¾ã¨ã‚

ã“ã®è¨ˆç”»ã«ã‚ˆã‚Šã€ä»¥ä¸‹ãŒå®Ÿç¾ã•ã‚Œã¾ã™ï¼š

âœ… **ã‚³ã‚¹ãƒˆå‰Šæ¸›**: ä¸æ­£åˆ©ç”¨ã‚’é˜²æ­¢ã—ã€å‹•ç”»ç”Ÿæˆã‚³ã‚¹ãƒˆã‚’ç®¡ç†
âœ… **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿è­·ã¨ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹å¯¾ç­–
âœ… **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£**: ã‚·ãƒ³ãƒ—ãƒ«ã§åˆ†ã‹ã‚Šã‚„ã™ã„UI
âœ… **ä¿å®ˆæ€§**: ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹æŸ”è»Ÿãªç®¡ç†

**æ¨å¥¨å®Ÿè£…æ–¹å¼**: ã‚ªãƒ—ã‚·ãƒ§ãƒ³3ï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ–¹å¼ï¼‰

**å®Ÿè£…é–‹å§‹ã®æº–å‚™ãŒã§ããŸã‚‰ã€ãŠçŸ¥ã‚‰ã›ãã ã•ã„ï¼**

