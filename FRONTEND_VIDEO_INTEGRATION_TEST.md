# フロントエンド動画生成機能 - ローカルテスト手順

## 📋 テスト概要

**目的**: 結果画面でトレーニング動画生成機能が正常に動作することを確認

**対象環境**: ローカル環境 (http://localhost)

**所要時間**: 約5分（動画生成に60〜70秒）

---

## 🧪 テスト手順

### Step 1: サービス起動確認

```bash
# すべてのサービスが起動していることを確認
docker compose ps

# 期待される結果:
# - frontend: Up (healthy)
# - video_generation: Up (healthy)
# - api_gateway: Up
# - video_processing: Up
# - analysis: Up
# - advice_generation: Up
```

### Step 2: 動画アップロード

1. ブラウザで `http://localhost` にアクセス
2. Basic認証でログイン
   - ID: `xebio`
   - PW: `20251001`
3. ユーザーを選択（例: VF矢治）
4. ランニング動画をアップロード
5. 解析完了まで待機（約30〜60秒）

### Step 3: 結果画面で動画生成

1. 解析完了後、結果画面に自動遷移
2. ページ下部の「総合アドバイス」カードまでスクロール
3. 「💪 トレーニング動画」セクションを確認
4. 「トレーニング動画を生成」ボタンをクリック

**期待される動作**:
- ✅ ボタンクリック後、ローディングアニメーション表示
- ✅ 「動画を生成中...」メッセージ表示
- ✅ 「約60〜70秒かかります」の注意書き表示
- ✅ ブラウザコンソールに生成開始ログ

### Step 4: 動画生成完了確認

**待機時間**: 約60〜70秒

**期待される結果**:
- ✅ ローディングが消える
- ✅ 動画プレイヤーが表示される
- ✅ 「✅ AIが生成したトレーニング動画（4秒）」メッセージ
- ✅ 動画の再生ボタンが表示される

### Step 5: 動画再生確認

1. 動画プレイヤーの再生ボタンをクリック
2. 動画が正常に再生されることを確認

**期待される動作**:
- ✅ 4秒間の動画が再生される
- ✅ 音声なし（Sora-2の仕様）
- ✅ 解像度: 1280x720
- ✅ トレーニング内容に関連した動画

---

## 🔍 デバッグ方法

### ブラウザコンソールログ

**動画生成開始時**:
```
🎬 トレーニング動画生成開始: プランク: 体幹を鍛える基本エクササイズ...
```

**動画生成成功時**:
```
🎬 動画生成結果: {status: "success", video_url: "/api/video-generation/download/video_xxx", ...}
✅ 動画URL取得成功: /api/video-generation/download/video_xxx
```

**動画生成失敗時**:
```
❌ 動画生成エラー: ...
```

### Dockerログ確認

```bash
# video_generationサービスのログ
docker compose logs video_generation -f --tail=50

# 期待されるログ:
# - 🎬 動画生成リクエスト受信
# - 🎥 Sora-2 API呼び出し中...
# - 🔄 ポーリング (5s): status=queued
# - 🔄 ポーリング (60s): status=completed
# - ✅ 動画生成完了
```

### API Gateway確認

```bash
# API Gatewayのログ
docker compose logs api_gateway -f --tail=20

# 期待されるログ:
# - POST /api/video-generation/generate
# - GET /api/video-generation/download/video_xxx
```

---

## ❌ トラブルシューティング

### 問題1: 「動画生成に失敗しました」エラー

**原因**:
- OpenAI APIキーが無効
- Sora-2モデルへのアクセス権限なし
- ネットワークエラー

**対処法**:
```bash
# 1. APIキーを確認
grep OPENAI_API_KEY .env

# 2. video_generationサービスを再起動
docker compose restart video_generation

# 3. ログを確認
docker compose logs video_generation --tail=50
```

### 問題2: 動画が再生されない

**原因**:
- 動画URLが無効
- ダウンロードエンドポイントのエラー

**対処法**:
```bash
# 1. 動画URLを直接確認
curl -u xebio:20251001 "http://localhost/api/video-generation/download/video_xxx" -o test.mp4

# 2. ファイルタイプを確認
file test.mp4
# 期待: ISO Media, MP4 Base Media v1
```

### 問題3: ボタンをクリックしても反応しない

**原因**:
- フロントエンドのJavaScriptエラー
- アドバイステキストに「おすすめの補強ドリル」セクションがない

**対処法**:
1. ブラウザコンソールでエラーを確認
2. ページをリロード
3. 別の動画で再テスト

---

## ✅ テスト成功基準

- [ ] 動画アップロード成功
- [ ] 結果画面表示成功
- [ ] 「トレーニング動画を生成」ボタン表示
- [ ] ボタンクリックでローディング表示
- [ ] 60〜70秒後に動画プレイヤー表示
- [ ] 動画が正常に再生される
- [ ] 動画の長さが4秒
- [ ] エラーが発生しない

---

## 📊 パフォーマンス指標

| 項目 | 目標値 | 実測値 |
|------|--------|--------|
| 動画生成時間 | 60〜70秒 | ___秒 |
| 動画ファイルサイズ | 約700KB | ___KB |
| 動画解像度 | 1280x720 | ___ x ___ |
| 動画長さ | 4秒 | ___秒 |

---

## 🚀 次のステップ

ローカルテストが成功したら:

1. ✅ 本ドキュメントの「テスト成功基準」をすべてチェック
2. ✅ パフォーマンス指標を記録
3. ✅ スクリーンショットを撮影（オプション）
4. 🚀 EC2へのデプロイを開始

---

## 📝 テスト結果記録

**テスト実施日時**: _______________

**テスト実施者**: _______________

**結果**: [ ] 成功 / [ ] 失敗

**備考**:
```
（テスト中に気づいた点、改善提案など）
```

