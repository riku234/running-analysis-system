# カメラで被験者を追いかける（パン）ことについて

## ❌ 推奨されない理由

### 1. **ポーズ推定の精度低下**

#### 問題点
- **MediaPipe Poseは固定カメラを前提としている**: カメラが動くと、背景が動き、被験者の位置も変わるため、トラッキングが不安定になる
- **左右の識別が難しくなる**: カメラが動くと、被験者の向きが変わり、左足・右足の識別が不正確になる可能性がある
- **キーポイントの検出精度が低下**: カメラが動くと、フレーム内の被験者の位置が変わり、キーポイントの検出精度が低下する

#### 技術的な理由
```python
# 現在のシステムは以下の前提で動作しています：
# 1. 被験者がフレーム内の一定の位置にいる
# 2. カメラの向きが一定である
# 3. 背景が固定されている

# カメラが動くと：
# - 被験者の相対位置が変わる
# - 角度計算の基準点が変わる
# - 左右の識別が不正確になる
```

### 2. **角度計算の不正確性**

#### 体幹角度（Trunk Angle）
- **問題**: カメラが動くと、被験者の向きが変わり、体幹角度の計算が不正確になる
- **影響**: 姿勢の評価が不正確になる

#### 大腿角度・下腿角度（Thigh/Shank Angle）
- **問題**: カメラが動くと、被験者の向きが変わり、脚の角度計算が不正確になる
- **影響**: 着地・スイングの評価が不正確になる

### 3. **イベント検出の不安定性**

#### 問題点
- **接地・離地の検出が不正確**: カメラが動くと、足の位置が不正確になり、接地・離地の検出が不安定になる
- **サイクル検出の失敗**: カメラが動くと、ランニングサイクルの検出が失敗する可能性がある

---

## ✅ 推奨される撮影方法

### 1. **固定カメラ + トレッドミル（最推奨）**

#### セットアップ
```
【トップビュー】

背景（壁/フェンス）
    ║
    ║
    ║  ← ランナーの走行ライン（固定位置）
    ║
    ║
  📹 カメラ（三脚で固定、高さ1-1.5m）
```

#### メリット
- ✅ **被験者が同じ位置に留まる**: トレッドミルを使用することで、被験者がフレーム内の同じ位置に留まる
- ✅ **カメラを固定できる**: 三脚でカメラを固定し、手ブレを防止
- ✅ **角度計算が正確**: 被験者の向きが一定のため、角度計算が正確
- ✅ **左右の識別が正確**: 被験者の向きが一定のため、左足・右足の識別が正確

### 2. **固定カメラ + 広角レンズ（屋外ランニングの場合）**

#### セットアップ
```
【トップビュー】

背景（壁/フェンス）
    ║
    ║  ← ランナーの走行ライン（3-5m）
    ║
    ║
  📹 カメラ（三脚で固定、広角レンズ使用）
```

#### メリット
- ✅ **被験者がフレーム内に留まる**: 広角レンズを使用することで、被験者がフレーム内に留まる
- ✅ **カメラを固定できる**: 三脚でカメラを固定し、手ブレを防止
- ⚠️ **注意**: 被験者が画面端に近づくと精度が低下する可能性がある

### 3. **固定カメラ + 被験者がフレーム内を通過（最小限の推奨）**

#### セットアップ
```
【トップビュー】

背景（壁/フェンス）
    ║
    ║  ← ランナーの走行ライン（左から右へ）
    ║
    ║
  📹 カメラ（三脚で固定、広角レンズ使用）
```

#### 注意点
- ⚠️ **被験者が画面端に近づくと精度が低下**: 画面端に近づくと、キーポイントの検出精度が低下する
- ⚠️ **十分なランニングサイクルを確保**: 被験者がフレーム内にいる時間が短い場合、十分なランニングサイクルを確保できない可能性がある

---

## 🎯 実践的な推奨事項

### トレッドミルを使用する場合（最推奨）

1. **カメラを三脚で固定**
   - 高さ: ランナーの腰の高さ（1-1.5m）
   - 距離: 3-4メートル
   - 角度: 真横（90度）

2. **被験者をフレーム中央に配置**
   - フレームの60-80%を人物が占める
   - 頭から足首までが完全にフレーム内に収まる

3. **照明・背景を確保**
   - 十分な明るさを確保
   - ランナーと背景のコントラストを確保

### 屋外ランニングの場合

1. **広角レンズを使用**
   - 被験者がフレーム内に留まるようにする
   - ただし、画面端に近づくと精度が低下する可能性がある

2. **カメラを三脚で固定**
   - 手ブレを防止
   - カメラの向きを一定に保つ

3. **被験者がフレーム内にいる時間を確保**
   - 最低3-5秒（2-3サイクル以上）のランニングサイクルを確保

---

## 📊 精度への影響

### カメラを固定した場合
- ✅ **ポーズ推定精度**: 高い（MediaPipe Poseの最適条件）
- ✅ **角度計算精度**: 高い（被験者の向きが一定）
- ✅ **左右の識別精度**: 高い（被験者の向きが一定）
- ✅ **イベント検出精度**: 高い（足の位置が正確）

### カメラで被験者を追いかけた場合
- ❌ **ポーズ推定精度**: 低い（背景が動き、トラッキングが不安定）
- ❌ **角度計算精度**: 低い（被験者の向きが変わる）
- ❌ **左右の識別精度**: 低い（被験者の向きが変わる）
- ❌ **イベント検出精度**: 低い（足の位置が不正確）

---

## 🔧 現在のシステムの対応

現在のシステムには以下の自動補正機能が実装されていますが、**カメラが動く場合の補正は含まれていません**：

1. **解像度スケーリング**: 小さい動画は自動的に640px以上にスケールアップ
2. **画像前処理**: ノイズ除去、コントラスト調整、シャープ化
3. **スムージング**: 5フレームの移動平均により、キーポイントの揺れを低減
4. **構造的制約**: 膝-足首の位置関係チェックにより、異常値を補正

**これらの機能は、固定カメラでの撮影を前提としています。**

---

## 📝 まとめ

### ❌ 推奨されない方法
- **カメラで被験者を追いかける（パン）**: 精度が大幅に低下する

### ✅ 推奨される方法
1. **固定カメラ + トレッドミル（最推奨）**: 被験者が同じ位置に留まる
2. **固定カメラ + 広角レンズ**: 被験者がフレーム内に留まる
3. **固定カメラ + 被験者がフレーム内を通過**: 最小限の推奨

### 重要なポイント
1. **カメラを三脚で固定**: 手ブレを防止
2. **被験者をフレーム中央に配置**: 精度を最大化
3. **十分なランニングサイクルを確保**: 最低3-5秒（2-3サイクル以上）
4. **照明・背景を確保**: 十分な明るさとコントラスト

これらの条件を満たすことで、MediaPipe Poseによる骨格推定の精度を最大化できます。
